---
title: "Select number of topics for LDA model"
author: "Murzintcev Nikita"
date: '`r Sys.Date()`'
output:
  html_document:
    theme: united
    toc: yes
csl: acm-sigchi-proceedings.csl
bibliography: references.bib
vignette: |
  %\VignetteIndexEntry{Number of topics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
# library(printr)
# knitr::opts_chunk$set(cache=TRUE)
# knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

Install package from github (only once for the first time). Remember that this is first public version of the package and it can contain errors.

```{r, eval=FALSE}
devtools::install_github("nikita-moor/ldatuning")
```

Package `ldatuning` realize 4 metrics to select perfect number of topics for LDA model.

```{r, message=FALSE}
library("ldatuning")
```

Load "AssociatedPress" dataset from the `topicmodels` package.

```{r, message=FALSE}
library("topicmodels")
data("AssociatedPress", package="topicmodels")
dtm <- AssociatedPress[1:10, ]
```

The most easy way is to calculate all metrics at once. All existing methods require to train multiple LDA models to select one with the best performance. It is computation intensive procedure and `ldatuning` use parallelism, so do not forget to point correct number of CPU cores in `mc.core` parameter to archive the best performance. This version of package uses `mclapply` which doesn't actually run in parallel on Windows (reverts to serial evaluation), we are going to use `doParallel` or some other cross-platform method in future version.

All standard LDA methods and parameters from `topimodels` package can be set with `method` and `control`.

```{r, eval=TRUE}
result <- FindTopicsNumber(
  dtm,
  topics = seq(from = 2, to = 15, by = 1),
  metrics = c("Griffiths2004", "CaoJuan2009", "Arun2010", "Deveaud2014"),
  method = "Gibbs",
  control = list(seed = 77),
  mc.cores = 2L,
  verbose = TRUE
)
```

Result is a number of topics and corresponding values of metrics

```{r, echo=FALSE}
knitr::kable(result)
```

Simple approach in analyze of metrics is to find extremum, more complete description is in corresponding papers:

* minimization:
    + Arun2010 [@Arun2010]
    + CaoJuan2009 [@CaoJuan2009]

* maximization:
    + Deveaud2014 [@Deveaud2014]
    + Griffiths2004 [@Griffiths2004; @Ponweiser2012]

For easy analyze of the results can be used support function `FindTopicsNumber_plot`

```{r, fig.width=6, fig.height=3, results="hide"}
FindTopicsNumber_plot(result)
```

Results calculated on the whole dataset (about 10 hours on quad-core computer) looks like

```{r, fig.width=9, fig.height=5, echo=FALSE}
result <- read.csv(file = "files/APress.csv", header = TRUE)
FindTopicsNumber_plot(result[result$topics < 500, ])
```

From this plot can be made conclusion that optimal number of topics is in range 90-140. Metric Deveaud2014 is not informative in this situation.


# References
